<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

    <mapper namespace="ButtonMapper">

    <resultMap type="Button" id="buttonMap">
        <id column="BTN_ID" property="btnId"/>
        <result column="BTN_NAME" property="btnName"/>
        <result column="MENU_ID" property="menuId"/>
        <result column="DISABLED" property="disabled"/>
        <result column="REMARK" property="remark"/>
    </resultMap>
    <!-- 表名 -->
    <sql id="tableName">
        T_BUTTON
    </sql>

    <!-- 字段 -->
    <sql id="field">
        BTN_ID, BTN_NAME, MENU_ID, DISABLED, REMARK
    </sql>

    <!-- 字段值 -->
    <sql id="fieldValue">
        #{btnId}, #{btnName}, #{menuId}, #{disabled}, #{remark}
    </sql>

    <!-- 获取菜单按钮 -->
    <select id="getButtonInfo" parameterType="pd" resultType="pd">
        select <include refid="field"></include> from <include refid="tableName"></include>
        where 1=1
        <if test="menuId!=null">
            and MENU_ID = #{menuId}
        </if>
        <if test="disabled!=null">
            and DISABLED = #{disabled}
        </if>
    </select>


    <!-- 更新按钮是否可用 -->
    <update id="disabledButton" parameterType="pd">
        update
        <include refid="tableName"></include>
        SET
        DISABLED = #{disabled}
        where BTN_ID = #{btnId}
    </update>

    <!-- 获取按钮列表 -->
    <select id="selectButton" parameterType="pd" resultMap="buttonMap">
        select m.MENU_ID,m.MENU_NAME,m.ROOT_ID,b.BTN_ID,b.BTN_NAME
        from T_MENU m left join T_BUTTON  b
        on m.MENU_ID = b.MENU_ID
        where 1=1
    </select>

    <!-- 新增按钮 -->
    <insert id="saveButtonvity" parameterType="Button" useGeneratedKeys="true" keyProperty="btnId">
        insert into T_BUTTON( BTN_NAME,MENU_ID,DISABLED,REMARK)
        values( #{btnName},#{menuId},#{disabled},#{remark})
        <selectKey resultType="int" order="AFTER" keyProperty="btnId">
            SELECT IDENT_CURRENT('T_BUTTON')
        </selectKey>
    </insert>

    <!-- 获取按钮总数 -->
    <select id="getButtonCount" parameterType="String" resultType="pd">
        SELECT
            count(1) buttonCount
        FROM
            <include refid="tableName"></include>
    </select>

</mapper>
